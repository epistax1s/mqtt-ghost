"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[554],{8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var s=i(6540);const l={},r=s.createContext(l);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},9994:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"components/publish","title":"Publish","description":"The publish component is a named code block in the DSL used to configure and manage the publication of messages to MQTT","source":"@site/docs/components/publish.md","sourceDirName":"components","slug":"/components/publish","permalink":"/mqtt-mimic/docs/components/publish","draft":false,"unlisted":false,"editUrl":"https://github.com/epistax1s/mqtt-mimic/tree/master/doc/docs/components/publish.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Connect","permalink":"/mqtt-mimic/docs/components/connect"},"next":{"title":"Subscribe","permalink":"/mqtt-mimic/docs/components/subscribe"}}');var l=i(4848),r=i(8453);const o={sidebar_position:2},c="Publish",d={},t=[{value:"Basic Syntax",id:"basic-syntax",level:2},{value:"Properties",id:"properties",level:2},{value:"1. <code>topic</code>",id:"1-topic",level:3},{value:"2. <code>payload</code>",id:"2-payload",level:3},{value:"3. <code>qos</code>",id:"3-qos",level:3},{value:"4. <code>retain</code>",id:"4-retain",level:3},{value:"5. <code>expiryInterval</code>",id:"5-expiryinterval",level:3},{value:"6. <code>before</code>",id:"6-before",level:3},{value:"7. <code>after</code>",id:"7-after",level:3},{value:"8. <code>schedule</code> (Scheduling Block)",id:"8-schedule-scheduling-block",level:3},{value:"Key Features",id:"key-features",level:2},{value:"1. Named Component",id:"1-named-component",level:3},{value:"2. Dynamic Configuration",id:"2-dynamic-configuration",level:3},{value:"3. Scheduling",id:"3-scheduling",level:3},{value:"Controlling Publish Execution",id:"controlling-publish-execution",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"1. Simple Publish",id:"1-simple-publish",level:3},{value:"2. Scheduled Publish",id:"2-scheduled-publish",level:3},{value:"3. Dynamic Publish with Control",id:"3-dynamic-publish-with-control",level:3},{value:"4. Manual Trigger from Arbitrary Code",id:"4-manual-trigger-from-arbitrary-code",level:3},{value:"Notes and Recommendations",id:"notes-and-recommendations",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"publish",children:"Publish"})}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"publish"})," component is a named code block in the DSL used to configure and manage the publication of messages to MQTT\ntopics. Each ",(0,l.jsx)(n.code,{children:"publish"})," block has a unique name (e.g., ",(0,l.jsx)(n.code,{children:'"sendHello"'}),"), allowing it to be invoked, scheduled, or controlled\nfrom other parts of the DSL. The minimal configuration requires only a topic (",(0,l.jsx)(n.code,{children:"topic"}),") and message content (",(0,l.jsx)(n.code,{children:"payload"}),"). All\nother parameters are optional and can be used as needed to customize behavior, such as scheduling, adding logic before\nand after sending, or setting QoS and retention options."]}),"\n",(0,l.jsx)(n.h2,{id:"basic-syntax",children:"Basic Syntax"}),"\n",(0,l.jsxs)(n.p,{children:["A ",(0,l.jsx)(n.code,{children:"publish"})," block is defined with a name followed by a closure that specifies its properties. Here\u2019s a minimal example:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'publish("sendHello") {\n    topic = "greetings"\n    payload = "Hello, world!"\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["This creates a ",(0,l.jsx)(n.code,{children:"publish"})," action named ",(0,l.jsx)(n.code,{children:'"sendHello"'})," that sends ",(0,l.jsx)(n.code,{children:'"Hello, world!"'})," to the ",(0,l.jsx)(n.code,{children:"greetings"})," topic when triggered."]}),"\n",(0,l.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,l.jsxs)(n.h3,{id:"1-topic",children:["1. ",(0,l.jsx)(n.code,{children:"topic"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": The MQTT topic to publish the message to."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": String."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": Yes."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'topic = "mqtt-mimic/test/greetings"\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"2-payload",children:["2. ",(0,l.jsx)(n.code,{children:"payload"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": The content of the message to publish. Can include dynamic Groovy expressions for real-time customization."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": String."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": Yes."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'payload = "Hello, world! ID: ${UUID.randomUUID()}"\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"3-qos",children:["3. ",(0,l.jsx)(n.code,{children:"qos"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": The Quality of Service level for the message (0, 1, or 2)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Integer."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Default"}),": 0."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:"qos = 1\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"4-retain",children:["4. ",(0,l.jsx)(n.code,{children:"retain"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": Indicates whether the broker should retain the message as the last known value for the topic."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Boolean."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Default"}),": false."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:"retain = true\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"5-expiryinterval",children:["5. ",(0,l.jsx)(n.code,{children:"expiryInterval"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": The time (in seconds) after which the message expires on the broker."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Long."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Default"}),": 4,294,967,295 (maximum value)."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:"expiryInterval = 3600\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"6-before",children:["6. ",(0,l.jsx)(n.code,{children:"before"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": A closure executed before the message is published. Useful for adding custom logic or dynamically modifying the configuration."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Closure."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'before = { \n    println "Sending message..." \n}\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"7-after",children:["7. ",(0,l.jsx)(n.code,{children:"after"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": A closure executed after the message is published. Useful for follow-up actions or logging."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Closure."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'after = { \n    println "Message sent!" \n}\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"8-schedule-scheduling-block",children:["8. ",(0,l.jsx)(n.code,{children:"schedule"})," (Scheduling Block)"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Description"}),": A block for configuring periodic execution of the ",(0,l.jsx)(n.code,{children:"publish"})," action."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Subparameters"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"interval"}),": The interval (in milliseconds) between executions.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Long."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": Yes (within the schedule block)."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"startImmediately"}),": Whether the schedule starts immediately when the client starts.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Type"}),": Boolean."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required"}),": No."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Default"}),": false."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:"schedule {\n    interval = 5_000  // Every 5 seconds\n    startImmediately = true\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,l.jsx)(n.h3,{id:"1-named-component",children:"1. Named Component"}),"\n",(0,l.jsx)(n.p,{children:'Each publish block has a unique name, enabling it to be invoked manually via doAction("sendHello") or its schedule to be\ncontrolled with activateAction("sendHello") and deactivateAction("sendHello").'}),"\n",(0,l.jsx)(n.h3,{id:"2-dynamic-configuration",children:"2. Dynamic Configuration"}),"\n",(0,l.jsxs)(n.p,{children:["The configuration is rebuilt each time the action runs, allowing dynamic values in topic and payload (e.g., ",(0,l.jsx)(n.code,{children:"${env.prefix}"}),"\nor ",(0,l.jsx)(n.code,{children:"${UUID.randomUUID()}"}),"). The before and after closures can also modify the configuration or external context on the fly."]}),"\n",(0,l.jsx)(n.h3,{id:"3-scheduling",children:"3. Scheduling"}),"\n",(0,l.jsx)(n.p,{children:"The schedule block enables periodic message publishing. When activated, the action runs at the specified interval.\nIf startImmediately is true, it begins as soon as the client starts; otherwise, it requires explicit activation."}),"\n",(0,l.jsx)(n.h2,{id:"controlling-publish-execution",children:"Controlling Publish Execution"}),"\n",(0,l.jsxs)(n.p,{children:["The execution of a ",(0,l.jsx)(n.code,{children:"publish"})," action can be controlled using three key functions:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'doAction("name")'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Immediately triggers the named ",(0,l.jsx)(n.code,{children:"publish"})," action, sending the message once based on its current configuration. This works\nregardless of whether a schedule is defined or active."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Example"}),": ",(0,l.jsx)(n.code,{children:'doAction("sendHello")'}),' sends the message defined in the "sendHello" block right away.']}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:' activateAction("name")'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Activates the named ",(0,l.jsx)(n.code,{children:"publish"})," action\u2019s schedule, if one is defined. Once activated, the action will run periodically\naccording to the ",(0,l.jsx)(n.code,{children:"interval"})," set in the ",(0,l.jsx)(n.code,{children:"schedule"})," block until deactivated or the client stops."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Example"}),": ",(0,l.jsx)(n.code,{children:'activateAction("sendHello")'})," starts the scheduled publishing for ",(0,l.jsx)(n.code,{children:'"sendHello"'}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:'deactivateAction("name")'}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Deactivates the named ",(0,l.jsx)(n.code,{children:"publish"})," action\u2019s schedule, stopping periodic execution. The action will no longer publish\nmessages automatically until reactivated with ",(0,l.jsx)(n.code,{children:"activateAction"})," or triggered manually with ",(0,l.jsx)(n.code,{children:"doAction"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Example"}),": ",(0,l.jsx)(n.code,{children:'deactivateAction("sendHello")'})," pauses the scheduled publishing for ",(0,l.jsx)(n.code,{children:'"sendHello"'}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["These functions can be called from anywhere in the DSL \u2013 within ",(0,l.jsx)(n.code,{children:"subscribe"}),", ",(0,l.jsx)(n.code,{children:"action"}),", or standalone code \u2013 giving you full\ncontrol over when and how the ",(0,l.jsx)(n.code,{children:"publish"})," action executes."]}),"\n",(0,l.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,l.jsx)(n.h3,{id:"1-simple-publish",children:"1. Simple Publish"}),"\n",(0,l.jsx)(n.p,{children:"A one-time message publication:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'publish("sayHi") {\n    topic = "hello"\n    payload = "Hi there!"\n    qos = 1\n}\n\ndoAcion("sayHi")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-scheduled-publish",children:"2. Scheduled Publish"}),"\n",(0,l.jsx)(n.p,{children:"Sending a message every 5 seconds:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'publish("sendHello") {\n    topic = "greetings"\n    payload = "Hello, world! Msg #${UUID.randomUUID()}"\n    qos = 1\n    schedule {\n        interval = 5_000\n        startImmediately = true\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-dynamic-publish-with-control",children:"3. Dynamic Publish with Control"}),"\n",(0,l.jsx)(n.p,{children:"Publishing with a dynamic topic and control via subscriptions:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'env.prefix = UUID.randomUUID().toString()\n\npublish("sendHello") {\n    before = { println "Before sending..." }\n    topic = "mqtt-mimic/${env.prefix}/greetings"\n    payload = "Hello! ID: ${UUID.randomUUID()}"\n    qos = 1\n    retain = false\n    schedule {\n        interval = 5_000\n        startImmediately = false  // Waits for activation\n    }\n    after = { println "Message sent!" }\n}\n\nsubscribe("mqtt-mimic/${env.prefix}/on") { msg ->\n    // Starts periodic publishing\n    activateAction("sendHello")  \n}\n\nsubscribe("mqtt-mimic/${env.prefix}/off") { msg ->\n    // Stops the schedule; no messages are published until reactivated or triggered manually\n    deactivateAction("sendHello")\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Details"}),": Here, the schedule doesn\u2019t start automatically (",(0,l.jsx)(n.code,{children:"startImmediately = false"}),"). When activateAction(",(0,l.jsx)(n.code,{children:'"sendHello"'}),")\nis called, publishing begins every 5 seconds. Calling deactivateAction(",(0,l.jsx)(n.code,{children:'"sendHello"'}),") stops the schedule, halting automatic\nmessages. The action remains inactive until ",(0,l.jsx)(n.code,{children:"activateAction"})," is called again or ",(0,l.jsx)(n.code,{children:'doAction("sendHello")'})," triggers a one-time\npublication."]}),"\n",(0,l.jsx)(n.h3,{id:"4-manual-trigger-from-arbitrary-code",children:"4. Manual Trigger from Arbitrary Code"}),"\n",(0,l.jsxs)(n.p,{children:["Immediate publishing via ",(0,l.jsx)(n.code,{children:"doAction"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-groovy",children:'publish("manualSend") {\n    topic = "test"\n    payload = "Test message"\n}\n\naction("triggerSend") {\n    doAction("manualSend")\n}\n\n// Or invoke directly\ndoAction("manualSend")\n'})}),"\n",(0,l.jsx)(n.h2,{id:"notes-and-recommendations",children:"Notes and Recommendations"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Required Parameters"}),": Ensure topic and payload are specified, or the publication won\u2019t occur."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Dynamic Values"}),": Use environment variables (e.g., ",(0,l.jsx)(n.code,{children:"env.prefix"}),") or Groovy expressions in payload and topic to create\nunique messages."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Scheduling Control"}),": Decide whether the action should start immediately (startImmediately) or be controlled manually\nwith activateAction/deactivateAction. Without a schedule or manual trigger, the action won\u2019t run on its own."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Error Handling"}),": If the publication fails (e.g., due to an unavailable broker), an error message will appear in the\nlogs."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);